#INSTALACION DE DOCKER COMPOSE

apt install docker-compose

#REINICIO DE DOCKER

systemctl restart docker

#ESTA ES LA CONFIGURACION DEL SERVIDOR

#CREACION DEL ARCHIVO YML DONDE SE CONFIGURARA EL CONTENEDOR SERVIDOR

nano docker-compose.yml

version: "2.1"
services:
  # https://hub.docker.com/r/itsthenetwork/nfs-server-alpine
  nfs:
    image: itsthenetwork/nfs-server-alpine:12
    container_name: nfs
    restart: always
    privileged: true
    environment:
      - SHARED_DIRECTORY=/data
    volumes:
      - /data/docker-volumes:/data
    ports:
      - 2049:2049


#image: SELECCIONA LA IMAGEN PARA EL CONTENEDOR SERVIDOR
#container_name: ASIGNA UN NOMBRE AL CONTENEDOR SERVIDOR
#environment: SE ASIGNA LA CARPETA COMPARTIDA DATA
#volumes: SE CREA UN VOLUMEN DENTRO DEL CONTENEDOR EN EL DIRECTORIO /data
#ports: SELECCIONA UN PUERTO DE LA MAQUINA Y UN PUERTO DEL CONTENEDOR 

#LEVANTA EL CONTENEDOR SERVIDOR CON LA CONFIGURACCION DESIGNADA

sudo docker-compose up

#LA IP DE MI MAQUINA VIRTUAL ES

#10.0.2.15

#ESTA ES LA CONFIGURACION DE UN CLIENTE

#CREACION DE UN CLIENTE EN MODO PRIVILEGIADO PARA PODER UTILIZAR MOUNT (ESTO PUEDE TRAER PROBLEMAS DE AISLAMIENTO, NO SE USA EN PRODUCCION PORQUE SI ALGUIEN ACCEDE A ESTE CONTENEDOR PODRIA ESCAPAR DE EL Y COMENZAR A MOVERSE POR LA MAQUINA HOST CON PERMISOS ROOT)

sudo docker run --privileged -it --name primerCliente ubuntu bash

#SE ACTUALIZAN PAQUETES Y SE INSTALA NFS EN EL CONTENEDOR CLIENTE

apt update && apt install nfs-common -y

#SE CREA UNA CARPETA NFS QUE SERA DONDE SE COMPARTAN ARCHIVOS ENTRE CLIENTE Y SERVIDOR

mkdir nfs

#SE MONTA LA CARPETA NFS EN LA IP DE LA MAQUINA, AUTOMATICAMENTE SE DETECTARA POR EL SERVIDOR NFS Y SE CONECTARAN LAS CARPETAS COMPARTIDAS

mount -v -o vers=4,loud 10.0.2.15:/ /nfs

#SE INGRESA A LA CARPETA Y SE CREA UN ARCHIVO DE PRUEBA

cd nfs && touch prueba

#SE SALE DEL CONTENEDOR CLIENTE

exit

#SE INGRESA EN EL CONTENEDOR SERVIDOR

docker exec -it nfs bash 

#SE INGRESA EN LA CARPETA COMPARTIDA DENTRO DEL CONTENEDOR SERVIDOR PARA COMPROBAR QUE EL ARCHIVO prueba SE ENCUENTRE AHI

cd data

#SE HACE LS PARA VISUALIZAR

ls
